# ComfyTavern (Beta)

### 🌉 连接 AI 创作与终端体验的应用平台

ComfyTavern 旨在构建一座桥梁：将复杂的 AI 工作流，转化为任何用户都能轻松使用的交互式应用。
我们提供：

1.  **面向创作者**：一个强大、直观、高扩展性的可视化节点编辑器，用于编排复杂的 AI 逻辑。
2.  **面向最终用户**：将工作流封装为简洁、独立的 **交互式应用面板（迷你应用）**，用户无需理解底层节点，即可“开箱即用”地体验 AI 功能（如 AI 聊天、视觉小说、RPG、Agent 等）。

平台兼顾了创作的深度与使用的便捷性，就像把精密的齿轮（工作流）装进漂亮的钟表（应用面板），用户只需看时间，无需理解机械原理。

---

### ✨ 核心亮点

ComfyTavern 的核心逻辑：**工作流构建 → 引擎执行 → 应用封装**。

1.  **【愿景】从工作流到即用型应用面板 (App Panel)**
    这是 ComfyTavern 的核心价值所在。

    - **化繁为简**：将节点编辑器中构建的复杂工作流，封装成具备独立 UI 的“应用面板”。
    - **用户友好**：最终用户面对的是简洁直观的界面（如聊天窗口、游戏界面），而非复杂的节点连线，极大降低 AI 应用门槛。
    - **场景丰富**：支持但不限于 AI 聊天机器人、互动叙事/视觉小说、创意辅助、轻量游戏/模拟器、自动化助手等，并支持用户自定义。

2.  **【基础】直观强大的可视化工作流编排**
    基于成熟的 **VueFlow** 库，为 AI 创作者提供高效、灵活的节点编辑环境。

    - **深度优化的节点组 (NodeGroup)**：轻松将节点封装为可复用模块，支持从选中节点一键创建，提升模块化构建与迭代效率，应对复杂 AI 逻辑。
    - **流畅专业的编辑体验**：精简的 UI 与交互逻辑（如右键菜单、快捷操作），稳健的节点连接管理，让创作者专注于创意实现。
    - **高度可扩展**：提供清晰的 TypeScript 接口和开发指南，方便开发者集成新模型、服务、数据处理模块，创建自定义节点。

3.  **【性能】高性能与实时反馈的执行引擎** (核心接近完成)
    后端引擎采用异步并发设计，保障效率与实时性。

    - **流式处理**：已初步实现节点间流式数据传递、异步处理输入/输出、接口流式响应及后台任务管理。
    - **低延迟**：数据在处理步骤间近乎零延迟流转，通过 WebSocket 实时反馈执行状态，确保实时应用（如对话、动态生成）的流畅体验。

4.  **【扩展】开发者友好 & 架构开放**

    - 支持使用 TypeScript 定义节点逻辑，鼓励社区贡献。
    - 清晰的前后端分离架构，易于维护和扩展。
    - 计划提供工具，辅助迁移现有 SillyTavern 等平台的资产。

5.  **【规划】面向未来的智能架构**
    以下模块正在规划中，旨在构建更智能、更具适应性的 AI 应用基础：
    - ⏳ **深度情境知识引擎**：基于结构化“原子信息单元”进行知识管理，实现精细化检索、动态上下文注入及 Agent 与知识库的自适应交互。
    - ⏳ **智能 LLM 服务编排管理**：灵活的适配器与模型管理系统。用户根据 AI 能力（如文本生成、视觉理解）而非特定模型发起请求，系统智能路由。支持多渠道 API 管理、故障转移与负载均衡，确保服务高可用。
    - 🔭 **多智能体 (Multi-Agent) 协作基础**：基于知识引擎与 LLM 编排，为未来支持多 Agent 复杂交互与协同工作（如动态工具调用）奠定架构基础。(远期目标)

---

### 📄 文档

- **[节点类型系统](docs/node-types/node-types.zh.md)**：理解节点数据交互的基础，详述数据流类型 (`DataFlowType`)、插槽匹配类别 (`SocketMatchCategory`) 及连接规则。
- **[自定义节点开发指南](docs/guides/custom-node-development.zh.md)**：扩展 ComfyTavern 功能的详细步骤，包括后端定义、逻辑实现和前端渲染。

---

### 🚦 当前状态 (截至 2025 年)

**注意：项目处于早期 Beta 阶段，核心功能积极迭代中，欢迎反馈与贡献！**

- ✅ **基本框架设计**：完成项目架构、前后端分离。
- ✅ **前端节点编辑器 (VueFlow)**：核心编辑功能（拖拽、连接、参数、保存/加载、节点组、执行预览等）基本可用。
- ✅ **后端节点定义与动态加载**：规范与机制已基本实现。
- 🟡 **工作流执行引擎**：核心功能（节点图执行、流式数据传递、异步并发、后台任务管理）接近完成。
- ⏳ **应用面板封装与运行**：核心机制规划中。
- ⏳ **深度情境知识引擎**：规划中。
- ⏳ **智能 LLM 服务编排与管理**：规划中。
- ⏳ **移动端适配 (Tauri)**：规划中。
- ⏳ **内置 Agent 创作助手**：规划中。

**➡️ 当前核心体验：PC 端 VueFlow 节点编辑器 + 基础工作流执行能力。**

---

### 🏗️ 项目结构

```
apps/
  ├── backend/            # 后端服务 (Elysia + Bun)
  └── frontend-vueflow/   # 前端 (Vue 3 + Vite + VueFlow)
docs/                     # 文档
packages/
  ├── types/              # 共享 TypeScript 类型定义 (Zod schemas)
  └── utils/              # 共享工具函数
plugins/
  └── nodes/              # 第三方/用户自定义节点
projects/                 # 用户工作流项目数据
library/                  # 全局共享资产库
```

---

### 🛠️ 开发环境与运行

**环境要求:**

- [Bun](https://bun.sh) v1.2.5+ (主要运行时)
- Node.js v18+ (开发工具依赖)
- Windows / Linux / macOS

**安装:**

```bash
bun install
```

**运行:**
| 平台 | 生产模式 | 开发模式 |
| :---------- | :------------ | :---------------- |
| Windows | `.\start.bat` | `.\start.bat dev` |
| Linux/macOS | `./start.sh` | `./start.sh dev` |

**开发说明:**

- 开发服务器默认端口：
  - 前端：`http://localhost:5573/`
  - 后端：`http://localhost:3233/`

---

### 💻 技术栈

- **前端**: Vue 3 + TypeScript + Vite
- **节点编辑器**: [Vue Flow](https://vueflow.dev/)
- **后端**: [Bun](https://bun.sh/) + [Elysia](https://elysiajs.com/)
- **实时通信**: WebSocket
