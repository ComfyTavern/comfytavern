# ComfyTavern (beta)

### 一个面向创作者和最终用户的 AI 创作与应用平台

#### ComfyTavern 不仅仅是一个强大的可视化节点编辑器（基于 VueFlow），让创作者能够灵活编排复杂的 AI 工作流。更核心的是，它致力于将这些工作流封装成易于使用、面向特定场景的 **交互式应用面板（或称“迷你应用”）**。这些应用面板（例如：AI 聊天机器人、互动故事生成器、自动化数据处理工具、创意内容辅助等）使得最终用户无需理解底层节点逻辑，即可直接体验和使用 AI 功能。平台兼具开发者友好的扩展性，支持自定义节点和应用面板的开发。

---

### **核心特点**

1.  **强大的工作流编排（面向创作者）**

    - 提供基于 VueFlow 的可视化节点编辑器，支持灵活创建、修改和管理 AI 工作流。
    - 丰富的内置节点和易于扩展的自定义节点能力，满足多样化的创作需求。
    - 专注于创作，通过更直观的节点/插槽展示与自定义能力，简化操作流程，隐藏底层技术复杂度。

2.  **即用型 AI 应用面板（面向最终用户）**

    - **核心价值**：将复杂工作流封装成独立的、具有特定用户界面的“应用面板”（类似小程序或插件化应用）。
    - **用户体验**：为最终用户提供直接、友好的交互界面，隐藏底层工作流的复杂性，实现“即开即用”的 AI 功能体验。
    - **应用场景** (不限于此，鼓励用户自定义)：
      - AI 聊天机器人（可参考 SillyTavern 等应用的交互模式）
      - 互动叙事/视觉小说
      - 创意辅助工具（图像风格迁移、文本摘要等）
      - 轻量级游戏或模拟器
      - 自动化任务助手

3.  **开发者友好与扩展性**

    - 支持 TypeScript 定义节点逻辑，允许开发者贡献新功能和自定义节点。
    - 未来规划支持更便捷的应用面板开发和集成方式。

4.  **创作与技术的平衡**
    - 创作者可通过直观选项调整应用面板的界面风格（如主题色、对话框样式等，具体视面板类型而定）。
    - 开发者可深入底层，扩展多模态功能或集成更复杂的 AI 模型。

### **核心文档与指南**

为了帮助开发者更好地理解和扩展 ComfyTavern，我们提供了以下核心文档：

- **[节点类型系统](docs/node-types/node-types.zh.md)**：详细介绍了 ComfyTavern 的节点类型系统，包括数据流类型 (`DataFlowType`)、插槽匹配类别 (`SocketMatchCategory`) 以及它们之间的连接规则，是理解节点数据交互的基础。
- **[自定义节点开发指南](docs/guides/custom-node-development.zh.md)**：提供了详细的自定义节点开发步骤，包括后端定义、执行逻辑实现和前端渲染影响，帮助开发者扩展 ComfyTavern 的功能。
---

### **类比描述**

- **对开发者**：类似「ComfyUI」的扩展性，提供强大的底层能力和自定义空间。
- **对创作者**：结合了「ComfyUI」的节点式编排能力和「Twine」的叙事逻辑构建，同时提供类似「SillyTavern」的便捷应用面板封装体验。
- **对玩家用户**：作为「SillyTavern」的超级进化版，提供更丰富、更深度、更易用的 AI 交互应用。

---

## 当前状态 (截至 2025 年 6 月初)

**注意！本项目仍处于早期 Beta 开发阶段，许多核心功能仍在积极迭代中，欢迎反馈和贡献！**

- ✅ **基本框架设计**：完成项目整体架构规划。
- ✅ **前端节点编辑器 (VueFlow)**：核心编辑功能（节点拖拽、连接、参数配置、工作流保存/加载等）已基本可用。节点组功能持续增强，支持动态接口同步和引用工作流。
- ✅ **后端节点定义与动态加载**：节点定义规范及后端动态加载机制已初步实现。
- 🟡 **工作流执行引擎**：后端执行引擎已初步实现核心功能，如工作流接口的输入/输出处理、节点组的引用工作流支持等，但整体功能仍处于迭代完善阶段，需要进一步测试和优化。
- ❌ **应用面板封装与运行**：将工作流封装为独立“应用面板”的核心机制尚未开始开发。
- ❌ **移动端打包与适配 (Tauri)**：独立运行的移动端APP，可以不依赖bun环境部署的执行引擎。
- ❌ **内置 Agent 创作助手**：用于辅助创作者快速创建 AI 应用，比如工作流节点建议和生成，应用界面辅助开发等。

**目前 PC 端主要提供 VueFlow 节点编辑器体验。**

## 项目结构

```
apps/
  ├── backend/         # 后端服务 (Elysia + Bun)
  └── frontend-vueflow/# 前端 (Vue 3 + Vite + VueFlow)
docs/                   # 文档
  ├── guides/          # 开发指南
  ├── node-types/      # 节点类型定义
packages/
  ├── types/          # 共享 TypeScript 类型定义 (Zod schemas)
  └── utils/          # 共享工具函数
plugins/
  └── nodes/          # 用于放置第三方或用户自定义节点
projects/               # 用户创建的工作流项目数据
library/                # 全局共享资产库
```

## 开发环境要求

- [Bun](https://bun.sh) v1.2.5 或更高版本
- Node.js v18 或更高版本（用于开发工具）
- Windows/Linux/macOS 操作系统

## 安装

```bash
# 安装依赖
bun install
```

## 运行

### Windows

```bash
# 启动生产模式
.\start.bat

# 启动开发模式
.\start.bat dev
```

### Linux/macOS

```bash
# 启动生产模式
./start.sh

# 启动开发模式
./start.sh dev
```

## 开发说明

- 开发服务器默认端口：
  - 前端：http://localhost:5573/
  - 后端：http://localhost:3233/

## 技术栈

- 前端：Vue 3 + TypeScript + Vite
- 节点编辑器：Vue Flow
- 后端：Bun + Elysia
- WebSocket：用于实时通信
