# 设计文档：开发者生态与支持 (v1)

## 1. 引言与目标

一个成功的平台离不开一个活跃、健康的开发者生态。ComfyTavern 旨在通过提供全面的文档、易用的工具、丰富的示例和积极的社区支持，赋能开发者，使其能够轻松地创建创新的应用面板（微应用）、将平台能力集成到外部系统，并为平台本身贡献价值。

**目标**:

*   为不同类型的开发者提供清晰、准确、易于理解的文档资源。
*   提供必要的工具和资源，简化开发、调试和集成过程。
*   通过示例和教程降低学习曲线，激发创新。
*   建立一个互助、活跃的开发者社区。
*   持续关注并提升整体开发者体验 (DX)。

## 2. 目标开发者群体

ComfyTavern 的开发者生态主要面向以下群体：

*   **应用面板（微应用）创作者**：使用 Web 技术（HTML, CSS, JavaScript, WebAssembly 等）构建在 ComfyTavern 平台内运行的交互式应用面板的开发者。
*   **第三方 API 服务消费者/集成者**：希望通过 HTTP API 将 ComfyTavern 的工作流执行能力集成到其自有应用、后端服务或自动化脚本中的开发者。
*   **(未来) 自定义节点开发者**：为 ComfyTavern 平台贡献新的功能节点，扩展平台能力的开发者。
*   **(未来) 平台核心贡献者**：参与 ComfyTavern 开源项目核心代码开发的开发者。

## 3. 文档体系

全面、高质量的文档是开发者生态的基石。

### 3.1. 应用面板开发文档

*   **《应用面板规范 (`PanelDefinition`) 详解》**：
    *   详细解释 `PanelDefinition` JSON 对象的每个字段及其作用、可选值、示例。
    *   面板打包和目录结构要求。
*   **《`window.comfyTavernPanelApi` JavaScript API 参考》**：
    *   提供完整的 API 方法列表，包括每个方法的签名、参数说明、返回值、可能的错误、使用示例。
    *   与宿主环境安全通信的最佳实践（`postMessage` 验证等）。
    *   高级交互接口（如请求宿主服务）的使用指南。
*   **《应用面板创建指南》**：
    *   从零开始创建第一个应用面板的步骤教程。
    *   不同技术栈（纯JS、Vue、React、WASM应用）的面板开发示例。
    *   UI/UX 设计建议和最佳实践。
    *   状态管理策略。
    *   沙盒环境 (`<iframe>`) 的理解与 `sandbox` / `featurePermissions` 配置指南。
*   **《面板调试与测试指南》**：
    *   如何在浏览器开发者工具中有效调试 `<iframe>` 内的面板代码。
    *   利用平台提供的日志和诊断信息。
    *   单元测试和集成测试面板的建议。

### 3.2. HTTP API 参考文档

*   **OpenAPI (Swagger) 规范**：
    *   提供一个标准的 OpenAPI 3.x 规范文件，描述所有公开的 HTTP API 端点（包括与预定义工作流交互的 API、OpenAI 兼容 API、直接原始工作流执行 API）。
    *   可通过 Swagger UI 或 ReDoc 等工具在线浏览和交互测试。
*   **《API 认证与授权指南》**：
    *   详细说明 API Key 的获取、使用方式、安全管理建议。
    *   权限范围和未来可能的 OAuth 2.0 方案。
*   **《API 端点详解》**：
    *   对每个端点的用途、请求方法、URL 路径、请求头、请求体参数、响应状态码、响应体结构进行详细说明。
    *   提供多种编程语言（如 cURL, Python, JavaScript, Java）的请求示例代码片段。
*   **《错误代码与处理》**：列出所有可能的 API 错误代码及其含义和建议处理方式。
*   **《速率限制与使用策略》**：明确 API 的调用频率限制和其他使用策略。

### 3.3. (未来) 自定义节点开发文档

*   《ComfyTavern 节点开发入门》
*   《节点数据结构与生命周期》
*   《后端节点实现 (Python/TypeScript)》
*   《前端节点 UI 与交互 (Vue)》
*   《节点打包与发布规范》

### 3.4. 平台通用文档

*   **《ComfyTavern 核心概念》**：解释工作流、节点、应用面板、API 服务等核心术语和架构。
*   **《平台安装与配置指南》**。
*   **《版本发布说明 (Changelog)》**。
*   **《贡献指南》** (如果项目开源)。
*   **《FAQ (常见问题解答)》**。

## 4. 开发者工具与资源

*   **4.1. 应用面板开发**
    *   **面板项目脚手架/模板 (`create-comfytavern-panel`)**：
        *   提供一个命令行工具，可以快速生成基于不同技术栈（如纯 JS, Vue 3 + Vite, React + Vite, WASM 基础项目）的应用面板项目骨架。
        *   预置好与 `comfyTavernPanelApi` 的集成、推荐的目录结构、构建配置等。
    *   **`@comfytavern/panel-sdk` (NPM 包)**：
        *   提供 `window.comfyTavernPanelApi` 的 TypeScript 类型定义 (`.d.ts`)，增强面板开发时的类型安全和代码提示。
        *   可能包含一些辅助函数或工具类，简化与 API 的交互。
    *   **面板 UI 组件库 (可选)**：平台可以提供一套可选的、符合 ComfyTavern 视觉风格的基础 UI 组件，供面板开发者快速构建界面。
*   **4.2. API 集成**
    *   **API 客户端 SDK (多语言)**：
        *   为 ComfyTavern HTTP API 提供官方或社区贡献的客户端 SDK，例如：
            *   `@comfytavern/api-client-js` (JavaScript/TypeScript)
            *   `comfytavern-api-client-py` (Python)
        *   封装认证、请求构造、响应处理等逻辑，简化第三方集成。
    *   **Postman/Insomnia 集合**：提供预配置的 API 请求集合，方便开发者测试和探索 API。
*   **4.3. 调试支持**
    *   清晰的浏览器控制台日志输出（来自宿主和面板 API）。
    *   后端 API 请求的详细日志（需注意敏感信息过滤）。
    *   （未来）专门的开发者调试模式或工具。
*   **4.4. (未来) ComfyTavern CLI**
    *   用于项目初始化、面板打包、本地开发服务器、部署到平台、管理 API Key 等。

## 5. 社区与支持渠道

*   **官方文档网站**：作为所有文档和资源的中心入口。
*   **GitHub 代码仓库**：
    *   用于代码托管、Issue 跟踪 (Bug报告、功能请求)。
    *   GitHub Discussions 作为开发者论坛，用于提问、分享经验、讨论想法。
*   **即时通讯社区 (可选)**：如 Discord, Slack 等，用于更实时的交流和帮助。
*   **博客/教程系列**：定期发布关于平台新特性、最佳实践、案例研究等内容。
*   **贡献者激励计划** (如果适用)。

## 6. 开发者体验 (DX) 的持续改进

*   **建立开发者反馈机制**：通过问卷调查、社区投票、Issue 模板等方式主动收集开发者对文档、工具、API 设计的反馈。
*   **定期审视和迭代**：根据反馈和平台发展，定期更新文档，优化 API 设计，改进开发者工具。
*   **关注易用性和学习曲线**：努力降低新开发者上手平台的门槛。
*   **保持 API 的稳定性和向后兼容性**：谨慎对待破坏性变更，并提供清晰的迁移指南。