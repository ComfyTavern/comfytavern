# ComfyTavern å›½é™…åŒ– (i18n) æ–¹æ¡ˆ

## 1. ç›®æ ‡ä¸æ ¸å¿ƒåŸåˆ™

- **ç›®æ ‡**: ä¸º ComfyTavern åº”ç”¨çš„**åç«¯èŠ‚ç‚¹å®šä¹‰**æä¾›ä¸€å¥—çµæ´»ã€å¯æ‰©å±•ã€æ˜“äºç»´æŠ¤çš„å›½é™…åŒ–æ–¹æ¡ˆã€‚
- **æ ¸å¿ƒåŸåˆ™**:
  - **èŠ‚ç‚¹å®šä¹‰æºæ–‡ä»¶å¯è¯»æ€§**: èŠ‚ç‚¹å®šä¹‰ (`.ts`) æ–‡ä»¶ä¸­çš„å¯ç¿»è¯‘å­—æ®µä¿æŒä½¿ç”¨ä¸­æ–‡åŸæ–‡ï¼Œæ–¹ä¾¿å¼€å‘è€…é˜…è¯»å’Œç¼–å†™ã€‚
  - **è·¯å¾„çº¦å®šä¼˜äºé…ç½®**: é€šè¿‡æ–‡ä»¶å’Œç›®å½•çš„å‘½åä¸è·¯å¾„çº¦å®šæ¥å®šä½ç¿»è¯‘èµ„æºï¼Œå‡å°‘ç¡¬ç¼–ç å’Œæ˜¾å¼é…ç½®ã€‚
  - **åˆ†å±‚åŠ è½½ä¸è¦†ç›–**: æ”¯æŒå¤šå±‚çº§çš„ç¿»è¯‘æ–‡ä»¶æ¥æºï¼ˆèŠ‚ç‚¹åŒ…è‡ªå¸¦ã€å…¨å±€å…±äº«ã€ç”¨æˆ·è‡ªå®šä¹‰ï¼‰ï¼Œå¹¶å®ç°æ˜ç¡®çš„ä¼˜å…ˆçº§è¦†ç›–æœºåˆ¶ï¼ˆç”¨æˆ· > å…¨å±€ > èŠ‚ç‚¹åŒ…ï¼‰ã€‚
  - **åç«¯ä¸“æ³¨èŠ‚ç‚¹ç¿»è¯‘**: åç«¯ `LocalizationService` è´Ÿè´£å¤„ç†èŠ‚ç‚¹å®šä¹‰çš„ç¿»è¯‘é€»è¾‘ï¼Œå‘å‰ç«¯æä¾›å·²å®Œå…¨ç¿»è¯‘å¥½çš„ã€å•è¯­è¨€çš„èŠ‚ç‚¹å®šä¹‰æ•°æ®ã€‚
  - **å‰ç«¯ UI ç¿»è¯‘ç‹¬ç«‹**: å‰ç«¯åº”ç”¨ (`apps/frontend-vueflow`) è´Ÿè´£ç®¡ç†è‡ªèº«çš„ UI å›½é™…åŒ–ï¼ŒåŒ…æ‹¬å¼•å…¥å’Œç»´æŠ¤æ‰€éœ€çš„ç¿»è¯‘èµ„æºã€‚
  - **Namespace èŒè´£æ˜ç¡®**: èŠ‚ç‚¹çš„é¡¶å±‚ `namespace` (å¦‚ `core`, `npm.some-package`) ç”¨äºåŒºåˆ†èŠ‚ç‚¹æ¥æºå’Œä¿è¯ `fullType` çš„å”¯ä¸€æ€§ã€‚

## 2. æ–¹æ¡ˆè¯¦è¿°

### 2.1. `NodeDefinition` ä¸ `namespace`

- **æºæ–‡ä»¶ (`.ts`)**:
  - èŠ‚ç‚¹å®šä¹‰ä¸­çš„å¯ç¿»è¯‘å­—æ®µï¼ˆå¦‚ `category`, `displayName`, `description`ï¼Œä»¥åŠ `inputs` å’Œ `outputs` å†…éƒ¨çš„åŒåå­—æ®µï¼‰ç»§ç»­ä½¿ç”¨**ä¸­æ–‡åŸæ–‡**å­—ç¬¦ä¸²ã€‚
  - `node.namespace?: string`: æ­¤å­—æ®µä¸ºå¯é€‰ã€‚
    - **æ˜¾å¼æŒ‡å®šä¼˜å…ˆ**: èŠ‚ç‚¹å¼€å‘è€…å¯ä»¥åœ¨å…¶å®šä¹‰ä¸­æ˜¾å¼æä¾› `namespace` å­—ç¬¦ä¸²ã€‚
    - **è·¯å¾„æ¨æ–­å…œåº•**: å¦‚æœ `node.namespace` æœªåœ¨å®šä¹‰ä¸­æä¾›ï¼Œ`NodeManager` æœåŠ¡ä¼šæ ¹æ®è¯¥èŠ‚ç‚¹å®šä¹‰æ–‡ä»¶ (`node.filePath`) çš„ç‰©ç†è·¯å¾„æ¥æ¨æ–­ä¸€ä¸ª `namespace`ã€‚
      - **æ ¸å¿ƒèŠ‚ç‚¹** (ä½äº `apps/backend/src/nodes/` ä¸‹): ä½¿ç”¨ `core` ä½œä¸ºé¡¶å±‚ `namespace`ã€‚
      - **ç¬¬ä¸‰æ–¹èŠ‚ç‚¹** (ä¾‹å¦‚ npm åŒ…æˆ–æ’ä»¶ç›®å½•ä¸­çš„èŠ‚ç‚¹): é€šå¸¸åŸºäºå…¶åŒ…åæˆ–æ’ä»¶æ¨¡å—åç”Ÿæˆé¡¶å±‚ `namespace`ï¼Œä¾‹å¦‚ `npm.some-package`, `plugin.my-plugin`ã€‚
    - æ­¤æœ€ç»ˆç¡®å®šçš„é¡¶å±‚ `namespace` (æ— è®ºæ˜¯æ˜¾å¼æŒ‡å®šè¿˜æ˜¯æ¨æ–­çš„) ç”¨äºåŒºåˆ†èŠ‚ç‚¹æ¥æºï¼Œå¹¶ä¸ `node.type` ç»„åˆæˆå…¨å±€å”¯ä¸€çš„ `fullType` (æ ¼å¼: `namespace:type`)ã€‚

### 2.2. ç¿»è¯‘æ–‡ä»¶

- **å‘½åçº¦å®š**:
  - ä¸»è¦çš„ç¿»è¯‘æ–‡ä»¶ä»¥èŠ‚ç‚¹çš„é¡¶å±‚ `namespace` æ¥å‘½åï¼š`[namespace].[lang].json`ã€‚
    - ä¾‹å¦‚: `core.en-US.json`, `npm.some-package.zh-CN.json`ã€‚
  - é€šç”¨ç¿»è¯‘æ–‡ä»¶å‘½åä¸ºï¼š`global.[lang].json`ï¼Œç”¨äºå­˜æ”¾å…¬å…±è¯æ±‡çš„ç¿»è¯‘ï¼ˆå¦‚èŠ‚ç‚¹ `category` çš„åŸæ–‡ï¼‰ã€‚
- **å†…éƒ¨ç»“æ„**:
  - å¯¹äº `[final_namespace].[lang].json` æ–‡ä»¶ï¼š
    - å…¶é¡¶å±‚ JSON Key åº”ä¸ºè¯¥ `namespace` ä¸‹çš„èŠ‚ç‚¹ `type` (å­—ç¬¦ä¸²)ã€‚
    - å¯¹åº”çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ç»“æ„é•œåƒ `NodeDefinition` ä¸­éœ€è¦ç¿»è¯‘çš„éƒ¨åˆ†ï¼ŒåŒ…å«å„å­—æ®µçš„ç¿»è¯‘æ–‡æœ¬ã€‚
    - ç¤ºä¾‹ (`core.en-US.json`):
      ```json
      {
        "TextMerge": {
          "displayName": "Text Merge",
          "description": "Combines multiple text inputs into one text.",
          "category": "Utilities",
          "inputs": {
            "separator": {
              "displayName": "Separator",
              "description": "String used to separate texts."
            },
            "text_inputs": {
              "displayName": "Text Inputs"
            }
          },
          "outputs": {
            "merged_text": {
              "displayName": "Merged Text"
            }
          }
        },
        "TestWidgets": {
          "displayName": "ğŸ§ª Test Widgets Node",
          "description": "Node for testing various input widgets.",
          "category": "Utilities",
          "inputs": {
            "string_input": {
              "displayName": "Single Line Text",
              "description": "Single line text input test.",
              "config": {
                "placeholder": "Please enter single line text"
              }
            },
            "combo_select": {
              "displayName": "Dropdown Select",
              "description": "Test for dropdown selection.",
              "config": {
                "suggestions": [
                  { "displayName": "Option A" },
                  { "displayName": "Option B" },
                  { "displayName": "Option C" }
                ]
              }
            },
            "int_with_suggestions": {
              "displayName": "Integer with Suggestions",
              "description": "Test for integer input with suggestions.",
              "config": {
                "suggestions": [
                  { "displayName": "Two Hundred Fifty-Six (Low)" },
                  { "displayName": "Five Hundred Twelve (Medium)" },
                  { "displayName": "One Thousand Twenty-Four (High)" },
                  { "displayName": "Two Thousand Forty-Eight (Very High)" }
                ]
              }
            },
            "button_trigger": {
              "displayName": "Trigger Button",
              "description": "Test for button component.",
              "config": {
                "label": "Click Me!"
              }
            }
          }
        }
      }
      ```
  - å¯¹äº `global.[lang].json` æˆ– `common.[lang].json` æ–‡ä»¶ï¼š
    - å…¶å†…éƒ¨ Key å¯ä»¥æ˜¯**ä¸­æ–‡åŸæ–‡**å­—ç¬¦ä¸²ï¼ˆç”¨äºç›´æ¥ç¿»è¯‘èŠ‚ç‚¹å®šä¹‰ä¸­çš„æŸäº›é€šç”¨è¯æ±‡ï¼‰ï¼Œæˆ–è€…æ˜¯é¢„å®šä¹‰çš„**é€šç”¨ UI Key** (ä¾‹å¦‚ `"ui.button.save"`)ã€‚
    - ç¤ºä¾‹ (`global.en-US.json`):
      ```json
      {
        "å®ç”¨å·¥å…·": "Utilities", // åŸæ–‡ Key, å¯ç”¨äºç¿»è¯‘ category
        "ä¿å­˜": "Save", // åŸæ–‡ Key
        "ui.dialog.confirm": "Confirm" // é€šç”¨ UI Key
      }
      ```
- **å­—ç¬¦ç¼–ç **: æ‰€æœ‰ `.json` ç¿»è¯‘æ–‡ä»¶åº”ä½¿ç”¨ `UTF-8` ç¼–ç ã€‚

### 2.3. ç¿»è¯‘æ–‡ä»¶åŠ è½½å±‚çº§ä¸è·¯å¾„çº¦å®š

ä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œå‰åç«¯é‡‡ç”¨ç»Ÿä¸€çš„ç›®å½•ç»“æ„ã€‚ç¿»è¯‘æ–‡ä»¶å°†ä»ä»¥ä¸‹ä¸‰ä¸ªä¸»è¦å±‚çº§æŒ‰ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰åŠ è½½å’Œåˆå¹¶ï¼š

1.  **ç”¨æˆ·çº§è¦†ç›– (User Overrides) - æœ€é«˜ä¼˜å…ˆçº§**

    - **ç›®çš„**: ç”¨æˆ·ä¸ªäººå¯¹ç¿»è¯‘çš„å®šåˆ¶å’Œè¦†ç›–ã€‚
    - **ç‰©ç†è·¯å¾„**:
      - ä¸»ç›®å½•ä¸‹çš„ç›´æ¥æ–‡ä»¶: `ComfyTavern/userData/{userId}/library/locales/nodes/[namespace].[lang].json`
      - åŒ…å†…çš„æ–‡ä»¶: `ComfyTavern/userData/{userId}/library/locales/nodes/{åŒ…å}/[namespace].[lang].json`
    - **åŠ è½½æ–¹å¼**: é€šè¿‡ `FAMService.readFile()` åŠ è½½ã€‚`LocalizationService` ä» `UserContext` è·å–å½“å‰ `userId`ï¼Œå¹¶åŠ¨æ€å‘ç°å’ŒåŠ è½½æ‰€æœ‰ç¿»è¯‘æ–‡ä»¶ã€‚

2.  **å…¨å±€å…±äº«ç¿»è¯‘ (Global Shared Translations) - ä¸­é—´ä¼˜å…ˆçº§**

    - **ç›®çš„**: é¡¹ç›®ç»´æŠ¤è€…æˆ–ç¤¾åŒºæä¾›çš„é€šç”¨ç¿»è¯‘è¡¥å……ã€‚
    - **ç‰©ç†è·¯å¾„**:
      - ä¸»ç›®å½•ä¸‹çš„ç›´æ¥æ–‡ä»¶: `ComfyTavern/library/locales/nodes/[namespace].[lang].json`
      - åŒ…å†…çš„æ–‡ä»¶: `ComfyTavern/library/locales/nodes/{åŒ…å}/[namespace].[lang].json`
    - **åŠ è½½æ–¹å¼**: é€šè¿‡ `FAMService.readFile()` åŠ è½½ã€‚`LocalizationService` å°†åŠ¨æ€å‘ç°å’ŒåŠ è½½ã€‚

3.  **èŠ‚ç‚¹åŒ…è‡ªå¸¦ç¿»è¯‘ (Package-Provided) - æœ€ä½ä¼˜å…ˆçº§/é»˜è®¤**
    - **ç›®çš„**: èŠ‚ç‚¹ä½œè€…ä¸ºå…¶èŠ‚ç‚¹åŒ…æä¾›çš„åŸºç¡€ã€é»˜è®¤ç¿»è¯‘ã€‚
    - **æ ¸å¿ƒèŠ‚ç‚¹åŒ…**:
      - **ç‰©ç†è·¯å¾„**: ç”± `node.filePath` æ¨æ–­ï¼Œé€šå¸¸åœ¨å…¶æ¨¡å—è·¯å¾„ä¸‹ï¼Œä¾‹å¦‚:
        `apps/backend/src/nodes/[module_name]/locales/core.[lang].json`
        (e.g., `apps/backend/src/nodes/Utilities/locales/core.en-US.json`)
    - **ç¬¬ä¸‰æ–¹èŠ‚ç‚¹åŒ…** (npm åŒ…æˆ–æ’ä»¶):
      - **ç‰©ç†è·¯å¾„**: ç”± `node.filePath` æ¨æ–­ï¼Œé€šå¸¸åœ¨å…¶åŒ…çš„æ ¹ç›®å½•ä¸‹çš„ `locales` æ–‡ä»¶å¤¹ä¸­ï¼š
        `[package_root_path]/locales/[namespace].[lang].json`
        (e.g., `node_modules/some-plugin/locales/npm.some-plugin.en-US.json`)
    - **åŠ è½½æ–¹å¼**: `LocalizationService` æ ¹æ® `node.filePath` æ¨æ–­å‡ºè¿™äº›ç‰©ç†è·¯å¾„åï¼Œ**ç›´æ¥ã€å®‰å…¨åœ°è¯»å–è¿™äº›æ–‡ä»¶**ã€‚è¯»å–æ—¶éœ€ç¡®ä¿è·¯å¾„åœ¨é¢„æœŸçš„é¡¹ç›®æˆ–æ’ä»¶ç›®å½•ä¸‹ï¼Œé˜²æ­¢ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ã€‚

### 2.3.1. ç»Ÿä¸€ç›®å½•ç»“æ„ (Unified Directory Structure)

ä¸ºäº†ä¿æŒå‰åç«¯ç¿»è¯‘èµ„æºç®¡ç†çš„ä¸€è‡´æ€§ï¼Œæ‰€æœ‰ç”¨æˆ·çº§å’Œå…¨å±€å…±äº«çº§çš„ç¿»è¯‘æ–‡ä»¶éƒ½ç»Ÿä¸€å­˜æ”¾åœ¨ `ComfyTavern/library/locales/` å’Œ `ComfyTavern/userData/{userId}/library/locales/` ç›®å½•ä¸‹ã€‚

åœ¨ `locales` ç›®å½•å†…éƒ¨ï¼Œé€šè¿‡å­ç›®å½•å¯¹èµ„æºè¿›è¡ŒåŒºåˆ†ï¼š
- `nodes/`: å­˜æ”¾æ‰€æœ‰åç«¯èŠ‚ç‚¹ç›¸å…³çš„ç¿»è¯‘æ–‡ä»¶ã€‚
- `ui/`: å­˜æ”¾æ‰€æœ‰å‰ç«¯ç•Œé¢ç›¸å…³çš„ç¿»è¯‘åŒ…ã€‚

è¿™ç§ç»“æ„ä½¿å¾—ç®¡ç†å’Œè¦†ç›–ç¿»è¯‘èµ„æºæ›´åŠ æ¸…æ™°å’Œç›´è§‚ã€‚

### 2.4. `LocalizationService` (åç«¯æ ¸å¿ƒæœåŠ¡)

è¿™æ˜¯å¤„ç†æ‰€æœ‰å›½é™…åŒ–é€»è¾‘çš„æ ¸å¿ƒæœåŠ¡ã€‚

- **èŒè´£**:
  1.  æ¥æ”¶è¯·æ±‚ï¼ŒåŒ…å«ç›®æ ‡èŠ‚ç‚¹çš„ `fullType` (ä»ä¸­è§£æå‡º `finalNamespace` å’Œ `nodeType`)ã€ç›®æ ‡è¯­è¨€ `targetLang`ï¼Œä»¥åŠå½“å‰ `UserContext` (ç”¨äºè·å– `userId` ä»¥è®¿é—®ç”¨æˆ·çº§è¦†ç›–)ã€‚
  2.  æ ¹æ® `finalNamespace`, `nodeType`, `targetLang` å’Œ `userId`ï¼ŒæŒ‰ç…§ 2.3 èŠ‚æè¿°çš„ä¼˜å…ˆçº§å’Œè·¯å¾„çº¦å®šï¼ŒæŸ¥æ‰¾å¹¶åŠ è½½æ‰€æœ‰ç›¸å…³çš„è¯­è¨€æ–‡ä»¶ã€‚
      - å¯¹äºç”¨æˆ·è¦†ç›–å’Œå®˜æ–¹/æ¨èåŒ…ï¼Œä½¿ç”¨ `FAMService` è¯»å–ã€‚
      - å¯¹äºåŒ…è‡ªå¸¦ç¿»è¯‘ï¼Œæ ¹æ® `node.filePath` æ¨æ–­ç‰©ç†è·¯å¾„å¹¶ç›´æ¥å®‰å…¨è¯»å–ã€‚
  3.  å¯¹ä»å„å±‚çº§æˆåŠŸåŠ è½½çš„ã€é’ˆå¯¹åŒä¸€ `finalNamespace` (æˆ– `global`) å’Œ `targetLang` çš„ç¿»è¯‘æ•°æ®è¿›è¡Œ**æ·±åˆå¹¶**ã€‚é«˜ä¼˜å…ˆçº§æ¥æºçš„æ•°æ®å°†è¦†ç›–ä½ä¼˜å…ˆçº§æ¥æºçš„æ•°æ®ã€‚
  4.  ä»æœ€ç»ˆåˆå¹¶çš„ã€é’ˆå¯¹è¯¥ `finalNamespace` çš„è¯­è¨€æ•°æ®ä¸­ï¼Œæ ¹æ® `nodeType` æå–å‡ºè¯¥ç‰¹å®šèŠ‚ç‚¹çš„ç¿»è¯‘å¯¹è±¡ã€‚
  5.  å¦‚æœç›´æ¥çš„èŠ‚ç‚¹ç¿»è¯‘ä¸å®Œæ•´ï¼Œæˆ–éœ€è¦ç¿»è¯‘é€šç”¨è¯æ±‡ï¼ˆå¦‚ `category` çš„åŸæ–‡ï¼‰ï¼Œå¯å°è¯•åœ¨åˆå¹¶åçš„ `global` æˆ– `common` ç¿»è¯‘æ•°æ®ä¸­ï¼Œä»¥ä¸­æ–‡åŸæ–‡ä¸º Key è¿›è¡ŒæŸ¥æ‰¾ä½œä¸ºè¡¥å……ã€‚
  6.  è·å–è¯¥èŠ‚ç‚¹åŸå§‹çš„ã€åŒ…å«ä¸­æ–‡å†…å®¹çš„ `NodeDefinition` å¯¹è±¡ï¼ˆä» `NodeManager`ï¼‰ã€‚
  7.  åˆ›å»ºä¸€ä¸ªåŸå§‹ `NodeDefinition` çš„æ·±æ‹·è´ã€‚
  8.  å°†æå–å¹¶å¤„ç†å¥½çš„ç›®æ ‡è¯­è¨€ç¿»è¯‘å¯¹è±¡ï¼Œé€’å½’åœ°åº”ç”¨ï¼ˆè¦†ç›–ï¼‰åˆ°è¿™ä¸ªæ·±æ‹·è´çš„ `NodeDefinition` ä¸Šã€‚å¯¹äº `config.suggestions` æ•°ç»„çš„ç‰¹æ®Šå¤„ç†ï¼š
      - ç¡®ä¿ç¿»è¯‘æ–‡ä»¶ä¸­æä¾›çš„ `displayName` èƒ½æ­£ç¡®è¦†ç›–åŸå§‹èŠ‚ç‚¹å®šä¹‰ä¸­å¯¹åº”ä½ç½®å»ºè®®é¡¹çš„ `displayName`ï¼ˆå³ä½¿åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰ï¼‰ã€‚
      - `suggestions` æ•°ç»„ä¸­çš„ `value` å±æ€§å§‹ç»ˆå–è‡ªåŸå§‹èŠ‚ç‚¹å®šä¹‰ï¼Œä¸ä¼šè¢«ç¿»è¯‘æ–‡ä»¶è¦†ç›–ï¼ˆç¿»è¯‘æ–‡ä»¶ä¸­çš„ `suggestions` æ¡ç›®ç”šè‡³å¯ä»¥çœç•¥ `value` å±æ€§ï¼‰ã€‚
      - ç¿»è¯‘åˆå¹¶åº”æŒ‰æ•°ç»„ç´¢å¼•è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœç¿»è¯‘æ–‡ä»¶ä¸­çš„ `suggestions` æ•°ç»„æ¯”åŸå§‹å®šä¹‰çš„çŸ­ï¼Œåˆ™è¶…å‡ºéƒ¨åˆ†çš„åŸå§‹å»ºè®®é¡¹ä¿æŒä¸å˜ã€‚å¦‚æœç¿»è¯‘æ–‡ä»¶ä¸­çš„æ•°ç»„æ›´é•¿ï¼Œåˆ™è¶…å‡ºçš„ç¿»è¯‘é¡¹å°†è¢«å¿½ç•¥ï¼ˆå› ä¸ºæ²¡æœ‰å¯¹åº”çš„åŸå§‹ `value`ï¼‰ã€‚
  9.  è¿”å›è¿™ä¸ªå·²å®Œå…¨ç¿»è¯‘æˆç›®æ ‡è¯­è¨€çš„ã€å•è¯­è¨€ç‰ˆæœ¬çš„ `NodeDefinition` å¯¹è±¡ã€‚
  10. å®ç°é«˜æ•ˆçš„ç¼“å­˜æœºåˆ¶ï¼Œç¼“å­˜å·²åŠ è½½å’Œåˆå¹¶çš„è¯­è¨€æ–‡ä»¶å†…å®¹ä»¥åŠå·²ç¿»è¯‘çš„èŠ‚ç‚¹å®šä¹‰ï¼Œä»¥é¿å…é‡å¤ IO å’Œè®¡ç®—ã€‚ç¼“å­˜åº”åœ¨è¯­è¨€æ–‡ä»¶å˜æ›´æˆ–è¯­è¨€åˆ‡æ¢æ—¶å¤±æ•ˆã€‚

### 2.5. å‰ç«¯ UI ç¿»è¯‘æ–¹æ¡ˆ

å‰ç«¯ (`apps/frontend-vueflow`) å°†ç‹¬ç«‹è´Ÿè´£å…¶ç”¨æˆ·ç•Œé¢çš„å›½é™…åŒ–å®ç°ã€‚

#### 2.5.1. æŠ€æœ¯æ–¹æ¡ˆ

- **i18n åº“**: æ¨èä½¿ç”¨ `vue-i18n` è¿›è¡Œ Vue 3 åº”ç”¨çš„å›½é™…åŒ–å®ç°ã€‚
- **ç¿»è¯‘èµ„æºç»“æ„**: é‡‡ç”¨åˆ†å±‚çº§çš„ç¿»è¯‘èµ„æºç®¡ç†ï¼Œæ”¯æŒå†…ç½®ç¿»è¯‘å’Œç”¨æˆ·è‡ªå®šä¹‰ç¿»è¯‘åŒ…ã€‚
- **è¯­è¨€åŒ…çº¦å®š**: ä¸ºäº†ä¾¿äºç”¨æˆ·æ›¿æ¢å’Œæ‰©å±•ç¿»è¯‘ï¼Œå®šä¹‰ç»Ÿä¸€çš„è¯­è¨€åŒ…æ ‡è¯†ç¬¦ `@ComfyTavern-ui`ã€‚

#### 2.5.2. ç¿»è¯‘æ–‡ä»¶ç»„ç»‡ç»“æ„

**å†…ç½®ç¿»è¯‘æ–‡ä»¶ä½ç½®**ï¼š
```
apps/frontend-vueflow/src/locales/
â”œâ”€â”€ zh-CN.json          # ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰- é»˜è®¤è¯­è¨€
â”œâ”€â”€ en-US.json          # è‹±æ–‡ï¼ˆç¾å›½ï¼‰
â”œâ”€â”€ ja-JP.json          # æ—¥è¯­ï¼ˆæ—¥æœ¬ï¼‰
â”œâ”€â”€ es-ES.json          # è¥¿ç­ç‰™è¯­ï¼ˆè¥¿ç­ç‰™ï¼‰
â”œâ”€â”€ fr-FR.json          # æ³•è¯­ï¼ˆæ³•å›½ï¼‰
â”œâ”€â”€ de-DE.json          # å¾·è¯­ï¼ˆå¾·å›½ï¼‰
â”œâ”€â”€ ko-KR.json          # éŸ©è¯­ï¼ˆéŸ©å›½ï¼‰
â”œâ”€â”€ ru-RU.json          # ä¿„è¯­ï¼ˆä¿„ç½—æ–¯ï¼‰
â”œâ”€â”€ pt-BR.json          # è‘¡è„ç‰™è¯­ï¼ˆå·´è¥¿ï¼‰
â””â”€â”€ index.ts            # ç¿»è¯‘èµ„æºå¯¼å‡ºä¸é…ç½®
```

#### 2.5.3. ç”¨æˆ·è‡ªå®šä¹‰ç¿»è¯‘åŒ…æ”¯æŒ

ä¸ºäº†æ”¯æŒç±»ä¼¼ Minecraft èµ„æºåŒ…çš„ç¿»è¯‘æ›¿æ¢æœºåˆ¶ï¼Œå‰ç«¯å°†æ£€æŸ¥å¹¶åŠ è½½ä»¥ä¸‹è·¯å¾„çš„è‡ªå®šä¹‰ç¿»è¯‘ï¼š

**å¤–éƒ¨ç¿»è¯‘æ–‡ä»¶è·¯å¾„ä¼˜å…ˆçº§**ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. **ç”¨æˆ·çº§ç¿»è¯‘åŒ…** (æœ€é«˜ä¼˜å…ˆçº§):
   ```
   ComfyTavern/userData/{userId}/library/locales/ui/@ComfyTavern-ui/
   â”œâ”€â”€ zh-CN.json
   â”œâ”€â”€ en-US.json
   â””â”€â”€ custom-language.json
   ```

2. **å…¨å±€ç¿»è¯‘åŒ…** (ä¸­ç­‰ä¼˜å…ˆçº§):
   ```
   ComfyTavern/library/locales/ui/@ComfyTavern-ui/
   â”œâ”€â”€ zh-CN.json
   â”œâ”€â”€ en-US.json
   â””â”€â”€ custom-language.json
   ```

3. **å†…ç½®ç¿»è¯‘** (æœ€ä½ä¼˜å…ˆçº§):
   ```
   apps/frontend-vueflow/src/locales/
   ```

#### 2.5.4. è¯­è¨€åŒ…ç»“æ„çº¦å®š

**è‡ªåŒ…å«ç¿»è¯‘æ–‡ä»¶ç»“æ„ç¤ºä¾‹** (`zh-CN.json`):

æ¯ä¸ªè¯­è¨€æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€è‡ªåŒ…å«çš„åŒ…ã€‚å®ƒé€šè¿‡å†…éƒ¨çš„ `_meta` é”®æ¥æä¾›è‡ªèº«çš„å…ƒæ•°æ®ã€‚

```json
{
  "_meta": {
    "name": "Chinese (Simplified)",
    "nativeName": "ç®€ä½“ä¸­æ–‡"
  },
  "common": {
    "confirm": "ç¡®è®¤",
    "cancel": "å–æ¶ˆ",
    "save": "ä¿å­˜",
    "delete": "åˆ é™¤",
    "edit": "ç¼–è¾‘",
    "add": "æ·»åŠ ",
    "loading": "åŠ è½½ä¸­...",
    "error": "é”™è¯¯",
    "success": "æˆåŠŸ",
    "warning": "è­¦å‘Š"
  },
  "nav": {
    "home": "é¦–é¡µ",
    "editor": "ç¼–è¾‘å™¨",
    "settings": "è®¾ç½®",
    "about": "å…³äº"
  }
  // ... å…¶ä»–ç¿»è¯‘é”®
}
```

#### 2.5.5. åŠ¨æ€è¯­è¨€å‘ç°ä¸åŠ è½½

**è¯­è¨€åŒ…å‘ç°æœºåˆ¶**ï¼š
```typescript
// apps/frontend-vueflow/src/composables/useI18n.ts
interface LanguagePackManager {
  // å‘ç°æ‰€æœ‰å¯ç”¨çš„è¯­è¨€åŒ…
  discoverLanguagePacks(): Promise<AvailableLanguage[]>
  
  // åŠ è½½æŒ‡å®šè¯­è¨€çš„ç¿»è¯‘æ–‡ä»¶ï¼ˆæ”¯æŒåˆ†å±‚è¦†ç›–ï¼‰
  loadLanguage(languageCode: string): Promise<TranslationMessages>
  
  // è·å–æ”¯æŒçš„è¯­è¨€åˆ—è¡¨ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰è¯­è¨€ï¼‰
  getSupportedLanguages(): AvailableLanguage[]
}

interface AvailableLanguage {
  code: string           // è¯­è¨€ä»£ç ï¼Œå¦‚ 'zh-CN', 'en-US', 'custom-lang'
  name: string           // æ˜¾ç¤ºåç§°ï¼Œå¦‚ 'ç®€ä½“ä¸­æ–‡', 'English (US)'
  nativeName: string     // æœ¬åœ°åŒ–åç§°
  source: 'builtin' | 'global' | 'user'  // æ¥æºç±»å‹
  isCustom: boolean      // æ˜¯å¦ä¸ºè‡ªå®šä¹‰è¯­è¨€
}
```

**åŠ è½½ç­–ç•¥**ï¼š
1.  æ‰«ææ‰€æœ‰è¯­è¨€åŒ…ç›®å½• (`.../@ComfyTavern-ui/`)ï¼Œå‘ç°æ‰€æœ‰ `.json` è¯­è¨€æ–‡ä»¶ã€‚
2.  è¯»å–æ¯ä¸ªè¯­è¨€æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶ä»å…¶ `_meta` å­—æ®µä¸­è§£æå‡ºè¯­è¨€å…ƒä¿¡æ¯ï¼ˆ`name`, `nativeName`ï¼‰ã€‚
3.  æ ¹æ®ä¼˜å…ˆçº§ï¼ˆç”¨æˆ·çº§ > å…¨å±€çº§ > å†…ç½®ï¼‰æ„å»ºæœ€ç»ˆå¯ç”¨çš„è¯­è¨€åˆ—è¡¨ã€‚
4.  å½“éœ€è¦åŠ è½½ä¸€ç§è¯­è¨€æ—¶ï¼ŒæŒ‰ä¼˜å…ˆçº§åˆå¹¶æ‰€æœ‰æ¥æºçš„ç¿»è¯‘å†…å®¹ï¼ˆåŠ è½½æ—¶ä¼šå¿½ç•¥ `_meta` å­—æ®µï¼‰ã€‚
5.  æ”¯æŒåŠ¨æ€è¯­è¨€åˆ‡æ¢ï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚

#### 2.5.6. è®¾ç½®ç•Œé¢è¯­è¨€é€‰æ‹©

**è¯­è¨€é€‰é¡¹æ¥æº**ï¼š
- æ˜¾ç¤ºæ‰€æœ‰å‘ç°çš„è¯­è¨€ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰è¯­è¨€ï¼‰
- åŒºåˆ†å†…ç½®è¯­è¨€å’Œè‡ªå®šä¹‰è¯­è¨€ï¼ˆå¯é€‰æ‹©æ€§æ˜¾ç¤ºå›¾æ ‡æˆ–æ ‡è¯†ï¼‰
- æ”¯æŒè¯­è¨€çš„æœ¬åœ°åŒ–åç§°æ˜¾ç¤º

**è®¾ç½®å­˜å‚¨**ï¼š
```typescript
// apps/frontend-vueflow/src/stores/settingsStore.ts
interface I18nSettings {
  currentLanguage: string     // å½“å‰é€‰æ‹©çš„è¯­è¨€ä»£ç 
  fallbackLanguage: string   // å›é€€è¯­è¨€ä»£ç 
  autoDetect: boolean         // æ˜¯å¦è‡ªåŠ¨æ£€æµ‹æµè§ˆå™¨è¯­è¨€
}
```

#### 2.5.7. å®ç°ç»†èŠ‚

**åŠ è½½æµç¨‹**ï¼š
1. åº”ç”¨å¯åŠ¨æ—¶ï¼Œè°ƒç”¨ `discoverLanguagePacks()` å‘ç°æ‰€æœ‰å¯ç”¨è¯­è¨€
2. æ ¹æ®ç”¨æˆ·è®¾ç½®æˆ–æµè§ˆå™¨è¯­è¨€ç¡®å®šç›®æ ‡è¯­è¨€
3. ä½¿ç”¨ FAMService è¯»å–å¤–éƒ¨ç¿»è¯‘æ–‡ä»¶
4. å°†å†…ç½®ç¿»è¯‘ä¸å¤–éƒ¨ç¿»è¯‘åˆå¹¶ï¼Œå¤–éƒ¨ç¿»è¯‘å…·æœ‰æ›´é«˜ä¼˜å…ˆçº§
5. åˆå§‹åŒ– vue-i18n å®ä¾‹

**ç¼“å­˜ç­–ç•¥**ï¼š
- ç¿»è¯‘æ–‡ä»¶åŠ è½½åç¼“å­˜åœ¨å†…å­˜ä¸­
- ç›‘å¬å¤–éƒ¨ç¿»è¯‘æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°åŠ è½½
- æ”¯æŒå¼€å‘æ—¶çš„çƒ­é‡è½½

**é”™è¯¯å¤„ç†**ï¼š
- å¤–éƒ¨ç¿»è¯‘æ–‡ä»¶è¯»å–å¤±è´¥æ—¶ï¼Œå›é€€åˆ°å†…ç½®ç¿»è¯‘
- ç¿»è¯‘keyç¼ºå¤±æ—¶ï¼Œè‡ªåŠ¨å›é€€åˆ°é»˜è®¤è¯­è¨€æˆ–æ˜¾ç¤ºkeyæœ¬èº«
- æä¾›ç¿»è¯‘ç¼ºå¤±çš„æç¤ºæœºåˆ¶ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

#### 2.5.8. ä¸åç«¯èŠ‚ç‚¹ç¿»è¯‘çš„äº¤äº’

- å‰ç«¯UIç¿»è¯‘ä¸åç«¯èŠ‚ç‚¹ç¿»è¯‘å®Œå…¨ç‹¬ç«‹
- å‰ç«¯é€šè¿‡APIè¯·æ±‚æ—¶ä¼ é€’ `Accept-Language` å¤´æˆ–è¯­è¨€å‚æ•°
- åç«¯è¿”å›å·²ç¿»è¯‘çš„èŠ‚ç‚¹å®šä¹‰ï¼Œå‰ç«¯ç›´æ¥ä½¿ç”¨
- è¯­è¨€åˆ‡æ¢æ—¶ï¼ŒåŒæ—¶æ›´æ–°å‰ç«¯UIå’Œé‡æ–°è¯·æ±‚èŠ‚ç‚¹æ•°æ®

#### 2.5.9. å¼€å‘ä¾¿åˆ©æ€§

**å¼€å‘å·¥å…·æ”¯æŒ**ï¼š
```typescript
// å¼€å‘æ¨¡å¼ä¸‹çš„ç¿»è¯‘è¾…åŠ©å·¥å…·
interface I18nDevTools {
  // æ£€æŸ¥ç¼ºå¤±çš„ç¿»è¯‘key
  findMissingKeys(): string[]
  
  // å¯¼å‡ºå½“å‰ä½¿ç”¨çš„æ‰€æœ‰ç¿»è¯‘key
  exportUsedKeys(): string[]
  
  // éªŒè¯ç¿»è¯‘æ–‡ä»¶å®Œæ•´æ€§
  validateTranslations(): ValidationResult[]
}
```

**TypeScriptæ”¯æŒ**ï¼š
- ä¸ºç¿»è¯‘keyæä¾›ç±»å‹å®‰å…¨
- è‡ªåŠ¨ç”Ÿæˆç¿»è¯‘æ–‡ä»¶çš„TypeScriptç±»å‹å®šä¹‰
- IDEè‡ªåŠ¨è¡¥å…¨æ”¯æŒ

#### 2.5.10. æœªæ¥æ‰©å±•

- **ç¤¾åŒºç¿»è¯‘æ”¯æŒ**: å…è®¸ç¤¾åŒºè´¡çŒ®ç¿»è¯‘åŒ…
- **åœ¨çº¿ç¿»è¯‘ç¼–è¾‘å™¨**: æä¾›ç•Œé¢åŒ–çš„ç¿»è¯‘ç¼–è¾‘å·¥å…·
- **ç¿»è¯‘è´¨é‡éªŒè¯**: è‡ªåŠ¨æ£€æŸ¥ç¿»è¯‘å®Œæ•´æ€§å’Œä¸€è‡´æ€§
- **å¤šæ–¹è¨€æ”¯æŒ**: æ”¯æŒåŒä¸€è¯­è¨€çš„ä¸åŒåœ°åŒºå˜ä½“
- **RTLè¯­è¨€æ”¯æŒ**: ä¸ºé˜¿æ‹‰ä¼¯è¯­ç­‰ä»å³åˆ°å·¦çš„è¯­è¨€æä¾›æ”¯æŒ

### 2.6. å¯ç¿»è¯‘å­—æ®µçº¦å®š

- é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¦å®šä»¥ä¸‹åç§°çš„å­—æ®µæ˜¯å¯ç¿»è¯‘çš„ï¼Œæ— è®ºå®ƒä»¬å‡ºç°åœ¨ `NodeDefinition` çš„é¡¶å±‚è¿˜æ˜¯åµŒå¥—åœ¨ `inputs`, `outputs` å¯¹è±¡å†…éƒ¨ï¼š
  - `displayName`
  - `description`
  - `category` (é€šå¸¸åœ¨é¡¶å±‚)
  - å…¶ä»–æœªæ¥å¯èƒ½å¢åŠ çš„ã€é€‚åˆç¿»è¯‘çš„æ–‡æœ¬å­—æ®µã€‚
- æ­¤å¤–ï¼Œ`inputs` å†…éƒ¨çš„ `config` å¯¹è±¡ä¸­çš„ä»¥ä¸‹å­—æ®µï¼ˆå¦‚æœå­˜åœ¨ä¸”å…¶å€¼ä¸ºå­—ç¬¦ä¸²ï¼‰ä¹Ÿåº”è¢«è§†ä¸ºå¯ç¿»è¯‘ï¼š
  - `label` (ä¾‹å¦‚æŒ‰é’®æ ‡ç­¾)
  - `placeholder` (ä¾‹å¦‚è¾“å…¥æ¡†å ä½ç¬¦)
  - `default` (å¦‚æœå…¶å€¼ä¸ºå­—ç¬¦ä¸²ä¸”é€‚åˆç¿»è¯‘ï¼Œä¾‹å¦‚é»˜è®¤çš„æç¤ºæ–‡æœ¬)
- å¯¹äº `config.suggestions` å­—æ®µï¼Œå…¶ç»“æ„åº”ä¸º `Array<{ displayName?: string, value: any }>`ï¼š
  - æ•°ç»„ä¸­æ¯ä¸ªå¯¹è±¡çš„ `displayName` å±æ€§æ˜¯å›½é™…åŒ–çš„ç›®æ ‡ã€‚
  - **ç¿»è¯‘æ–‡ä»¶å¯ä»¥ä¸ºä»»ä½•å»ºè®®é¡¹æä¾› `displayName` çš„ç¿»è¯‘æ–‡æœ¬ï¼Œå³ä½¿è¯¥å»ºè®®é¡¹åœ¨åŸå§‹èŠ‚ç‚¹å®šä¹‰ä¸­çš„ `displayName` ä¸ºç©ºæˆ–æœªå®šä¹‰ã€‚å¦‚æœç¿»è¯‘æ–‡ä»¶æä¾›äº† `displayName`ï¼Œå®ƒå°†ä¼˜å…ˆä½¿ç”¨ã€‚**
  - å¦‚æœç¿»è¯‘æ–‡ä»¶æœªå¯¹æŸä¸ªå»ºè®®é¡¹çš„ `displayName` è¿›è¡Œç¿»è¯‘ï¼ˆæˆ–ç¿»è¯‘ä¸ºç©ºï¼‰ï¼Œä¸”åŸå§‹ `displayName` ä¹Ÿä¸ºç©ºæˆ–æœªå®šä¹‰ï¼Œåˆ™å‰ç«¯ UI åº”è€ƒè™‘ç›´æ¥æ˜¾ç¤ºè¯¥å»ºè®®é¡¹çš„ `value`ï¼ˆæ ¼å¼åŒ–åï¼‰ã€‚
- `LocalizationService` åœ¨åº”ç”¨ç¿»è¯‘æ—¶ä¼šé€’å½’åœ°æŸ¥æ‰¾å¹¶æ›¿æ¢è¿™äº›çº¦å®šå­—æ®µçš„å€¼ã€‚å¯¹äº `config` å†…éƒ¨çš„å­—æ®µï¼Œç¿»è¯‘æ–‡ä»¶éœ€è¦ä¿æŒç›¸åŒçš„åµŒå¥—ç»“æ„ã€‚

## 3. å®æ–½è¦ç‚¹ä¸æµç¨‹

1.  **æ£€æŸ¥ä¸è°ƒæ•´ `NodeManager`**:

    - ç¡®è®¤ `namespace` æ¨æ–­é€»è¾‘çš„æ­£ç¡®æ€§ï¼Œä¿æŒç°æœ‰çš„é¡¶å±‚å‘½åç©ºé—´æ¨æ–­ (å¦‚ `core`, `npm.some-package`)ã€‚
    - ç¡®ä¿ `NodeDefinition` å¯¹è±¡æ­£ç¡®è®°å½•å…¶ `filePath` å’Œé¡¶å±‚ `namespace`ã€‚

2.  **å®ç° `LocalizationService`**:

    - å®ç°å¤šå±‚çº§ç¿»è¯‘æ–‡ä»¶å‘ç°å’ŒåŠ è½½é€»è¾‘ï¼š
      - ç”¨æˆ·çº§å’Œå…¨å±€å…±äº«çº§ï¼šä½¿ç”¨ `FAMService` åŠ¨æ€å‘ç°å’ŒåŠ è½½ `.../locales/` ä¸‹çš„ç›´æ¥ JSON æ–‡ä»¶ä»¥åŠä¸€çº§å­ç›®å½•ä¸­çš„ JSON æ–‡ä»¶ã€‚
      - èŠ‚ç‚¹åŒ…è‡ªå¸¦çº§ï¼šæ ¹æ® `node.filePath` ç›´æ¥åŠ è½½å¯¹åº”çš„ç¿»è¯‘æ–‡ä»¶ã€‚
    - å®ç°ç¿»è¯‘æ•°æ®æŒ‰ä¼˜å…ˆçº§ï¼ˆç”¨æˆ· > å…¨å±€ > èŠ‚ç‚¹åŒ…ï¼‰çš„æ·±åˆå¹¶é€»è¾‘ã€‚
    - å®ç°å°†åˆå¹¶åçš„ç¿»è¯‘åº”ç”¨åˆ°èŠ‚ç‚¹å®šä¹‰å‰¯æœ¬çš„é€»è¾‘ã€‚
    - å®ç°ç¼“å­˜æœºåˆ¶ï¼Œä¼˜åŒ–å¤šèŠ‚ç‚¹æ‰¹é‡ç¿»è¯‘çš„æ€§èƒ½ã€‚

3.  **åˆ›å»ºç¤ºä¾‹ç¿»è¯‘æ–‡ä»¶ç»“æ„**:
    - åœ¨æ ¸å¿ƒèŠ‚ç‚¹æ¨¡å—ä¸‹åˆ›å»º `locales` ç›®å½•ï¼Œæ·»åŠ  `core.[lang].json` ç¤ºä¾‹æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œä¸º `TestWidgetsNode` åˆ›å»º `apps/backend/src/nodes/Utilities/locales/core.en-US.json`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
    ````json
    {
      "TestWidgets": {
        "displayName": "ğŸ§ª Test Widgets Node",
        "description": "Node for testing various input widgets.",
        "category": "Utilities",
        "inputs": {
          "string_input": {
            "displayName": "Single Line Text",
            "description": "Single line text input test.",
            "config": {
              "default": "This is default text",
              "placeholder": "Please enter single line text"
            }
          },
          "text_input": {
            "displayName": "Multi-line Text",
            "description": "Multi-line text input test.",
            "config": {
              "default": "This is default\nmulti-line text",
              "placeholder": "Please enter multi-line text"
            }
          },
          "markdown_input": {
            "displayName": "Markdown Text",
            "description": "Markdown content input test.",
            "config": {
              "default": "# Title\n\nThis is a piece of *Markdown* text with a [link](https://example.com).\n\n```python\nprint(\"Hello\")\n```"
            }
          },
          "int_input": {
            "displayName": "Integer",
            "description": "Integer input test."
          },
          "float_input": {
            "displayName": "Float Number",
            "description": "Float number input test."
          },
          "boolean_toggle": {
            "displayName": "Boolean Value",
            "description": "Boolean toggle test."
          },
          "combo_select": {
            "displayName": "Dropdown Select",
            "description": "Dropdown selection test.",
            "config": {
              "suggestions": [
                { "displayName": "Option A" },
                { "displayName": "Option B" },
                { "displayName": "Option C" }
              ]
            }
          },
          "json_input": {
            "displayName": "JSON Object",
            "description": "JSON object input test (inline viewer).",
            "config": {
              "placeholder": "Please enter or edit JSON object"
            }
          },
          "javascript_code_input": {
            "displayName": "JS Code Snippet",
            "description": "JavaScript code snippet input test (button triggers editor).\n\nExample:\n```javascript\nfunction greet(name) {\n  console.log(`Hello, ${name}!`);\n}\ngreet(\"Test Node\");\n```"
          },
          "string_with_suggestions": {
            "displayName": "Text with Suggestions",
            "description": "Test for text input with suggestion list.",
            "config": {
              "default": "Default value",
              "placeholder": "Type or select suggestion",
              "suggestions": [
                { "displayName": "Preset A" },
                { "displayName": "Preset B" },
                { "displayName": "Another Preset" }
              ]
            }
          },
          "int_with_suggestions": {
            "displayName": "Integer with Suggestions",
            "description": "Test for integer input with suggestion list.",
            "config": {
              "suggestions": [
                { "displayName": "Two Hundred Fifty-Six (Low Resolution)" },
                { "displayName": "Five Hundred Twelve (Medium Resolution)" },
                { "displayName": "One Thousand Twenty-Four (High Resolution)" },
                { "displayName": "Two Thousand Forty-Eight (Very High Resolution)" }
              ]
            }
          },
          "float_with_suggestions": {
            "displayName": "Float with Suggestions",
            "description": "Test for float input with suggestion list.",
            "config": {
              "suggestions": [
                { "displayName": "Minimum (1.0)" },
                { "displayName": "Medium Low (5.0)" },
                { "displayName": "Medium (7.5)" },
                { "displayName": "Medium High (10.0)" },
                { "displayName": "Maximum (12.5)" }
              ]
            }
          },
          "button_trigger": {
            "displayName": "Trigger Button",
            "description": "Test for button component.",
            "config": {
              "label": "Click Me to Execute Operation!"
            }
          }
        },
        "outputs": {
          "string_output": {
            "displayName": "Single Line Text Output",
            "description": "Single line text output."
          },
          "text_output": {
            "displayName": "Multi-line Text Output",
            "description": "Multi-line text output."
          },
          "markdown_output": {
            "displayName": "Markdown Text Output",
            "description": "Markdown content output."
          },
          "int_output": {
            "displayName": "Integer Output",
            "description": "Integer output."
          },
          "float_output": {
            "displayName": "Float Number Output",
            "description": "Float number output."
          },
          "boolean_output": {
            "displayName": "Boolean Value Output",
            "description": "Boolean value output."
          },
          "combo_output": {
            "displayName": "Selected Option Output",
            "description": "Selected option output."
          },
          "json_output": {
            "displayName": "JSON Object Output",
            "description": "JSON object output."
          },
          "javascript_code_output": {
            "displayName": "JS Code Snippet Output",
            "description": "JavaScript code snippet output."
          },
          "string_with_suggestions_output": {
            "displayName": "Text with Suggestions Output",
            "description": "Output value of text with suggestions."
          },
          "int_with_suggestions_output": {
            "displayName": "Integer with Suggestions Output",
            "description": "Output value of integer with suggestions."
          },
          "float_with_suggestions_output": {
            "displayName": "Float with Suggestions Output",
            "description": "Output value of float with suggestions."
          }
        }
      }
    }
    ````
    - åœ¨ `ComfyTavern/library/locales/` ç›®å½•ä¸‹åˆ›å»ºç¤ºä¾‹å…¨å±€ç¿»è¯‘æ–‡ä»¶ï¼Œä¾‹å¦‚ `global.en-US.json`:
    ```json
    {
      "å®ç”¨å·¥å…·": "Utilities",
    ```

## 5. é™„å½•ï¼šTestWidgetsNode.ts å¯ç¿»è¯‘é¡¹è¯¦ç»†åˆ—è¡¨

åŸºäº `apps/backend/src/nodes/Utilities/TestWidgetsNode.ts` çš„åˆ†æï¼Œå¹¶å‡è®¾å…¶ `config.suggestions` å·²æ›´æ–°ä¸º `Array<{ displayName?: string, value: any }>` ç»“æ„ï¼Œä»¥ä¸‹æ˜¯è¯¥èŠ‚ç‚¹ä¸­æ‰€æœ‰å¯ç¿»è¯‘çš„é¡¹ç›®åŠå…¶è‹±æ–‡ç¿»è¯‘ç¤ºä¾‹ã€‚

### 5.1. é¡¶å±‚å­—æ®µ

- `category`: "å®ç”¨å·¥å…·" â†’ "Utilities"
- `displayName`: "ğŸ§ª æµ‹è¯•ç»„ä»¶èŠ‚ç‚¹" â†’ "ğŸ§ª Test Widgets Node"
- `description`: "ç”¨äºæµ‹è¯•å„ç§è¾“å…¥ç»„ä»¶çš„èŠ‚ç‚¹" â†’ "Node for testing various input widgets."

### 5.2. Inputs å¯ç¿»è¯‘é¡¹

| è¾“å…¥é¡¹ Key (`TestWidgets.inputs.[key]`) | å¯ç¿»è¯‘å­—æ®µ (`*.displayName`, `*.description`, `*.config.label`, `*.config.placeholder`, `*.config.default` (string), `*.config.suggestions[i].displayName`) | åŸå§‹ä¸­æ–‡                         | è‹±æ–‡ç¿»è¯‘ç¤ºä¾‹ (æ¥è‡ª `core.en-US.json` ç¤ºä¾‹)        |
| --------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------- | ------------------------------------------------- |
| `string_input`                          | `displayName`                                                                                                                                               | "å•è¡Œæ–‡æœ¬"                       | "Single Line Text"                                |
|                                         | `description`                                                                                                                                               | "å•è¡Œæ–‡æœ¬è¾“å…¥æµ‹è¯•"               | "Single line text input test."                    |
|                                         | `config.default`                                                                                                                                            | "è¿™æ˜¯é»˜è®¤æ–‡æœ¬"                   | "This is default text"                            |
|                                         | `config.placeholder`                                                                                                                                        | "è¯·è¾“å…¥å•è¡Œæ–‡æœ¬"                 | "Please enter single line text"                   |
| `text_input`                            | `displayName`                                                                                                                                               | "å¤šè¡Œæ–‡æœ¬"                       | "Multi-line Text"                                 |
|                                         | `description`                                                                                                                                               | "å¤šè¡Œæ–‡æœ¬è¾“å…¥æµ‹è¯•"               | "Multi-line text input test."                     |
|                                         | `config.default`                                                                                                                                            | "è¿™æ˜¯é»˜è®¤çš„\n å¤šè¡Œæ–‡æœ¬"          | "This is default\nmulti-line text"                |
|                                         | `config.placeholder`                                                                                                                                        | "è¯·è¾“å…¥å¤šè¡Œæ–‡æœ¬"                 | "Please enter multi-line text"                    |
| `markdown_input`                        | `displayName`                                                                                                                                               | "Markdown æ–‡æœ¬"                  | "Markdown Text"                                   |
|                                         | `description`                                                                                                                                               | "Markdown å†…å®¹è¾“å…¥æµ‹è¯•"          | "Markdown content input test."                    |
|                                         | `config.default`                                                                                                                                            | (åŸå§‹ Markdown ä¸­æ–‡å†…å®¹)         | (è‹±æ–‡ Markdown å†…å®¹ç¤ºä¾‹)                          |
| `int_input`                             | `displayName`                                                                                                                                               | "æ•´æ•°"                           | "Integer"                                         |
|                                         | `description`                                                                                                                                               | "æ•´æ•°è¾“å…¥æµ‹è¯•"                   | "Integer input test."                             |
| `float_input`                           | `displayName`                                                                                                                                               | "æµ®ç‚¹æ•°"                         | "Float Number"                                    |
|                                         | `description`                                                                                                                                               | "æµ®ç‚¹æ•°è¾“å…¥æµ‹è¯•"                 | "Float number input test."                        |
| `boolean_toggle`                        | `displayName`                                                                                                                                               | "å¸ƒå°”å€¼"                         | "Boolean Value"                                   |
|                                         | `description`                                                                                                                                               | "å¸ƒå°”å€¼å¼€å…³æµ‹è¯•"                 | "Boolean toggle test."                            |
| `combo_select`                          | `displayName`                                                                                                                                               | "ä¸‹æ‹‰é€‰æ‹©"                       | "Dropdown Select"                                 |
|                                         | `description`                                                                                                                                               | "ä¸‹æ‹‰é€‰æ‹©æµ‹è¯•"                   | "Dropdown selection test."                        |
|                                         | `config.suggestions[0].displayName`                                                                                                                         | "é€‰é¡¹ A"                         | "Option A"                                        |
|                                         | `config.suggestions[1].displayName`                                                                                                                         | "é€‰é¡¹ B"                         | "Option B"                                        |
|                                         | `config.suggestions[2].displayName`                                                                                                                         | "é€‰é¡¹ C"                         | "Option C"                                        |
| `json_input`                            | `displayName`                                                                                                                                               | "JSON å¯¹è±¡"                      | "JSON Object"                                     |
|                                         | `description`                                                                                                                                               | "JSON å¯¹è±¡è¾“å…¥æµ‹è¯• (å†…è”æŸ¥çœ‹å™¨)" | "JSON object input test (inline viewer)."         |
|                                         | `config.placeholder`                                                                                                                                        | "è¯·è¾“å…¥æˆ–ç¼–è¾‘ JSON å¯¹è±¡"         | "Please enter or edit JSON object"                |
| `javascript_code_input`                 | `displayName`                                                                                                                                               | "JS ä»£ç ç‰‡æ®µ"                    | "JS Code Snippet"                                 |
|                                         | `description`                                                                                                                                               | (åŸå§‹å«ä¸­æ–‡çš„ JS ç¤ºä¾‹æè¿°)       | (è‹±æ–‡ JS ç¤ºä¾‹æè¿°)                                |
| `string_with_suggestions`               | `displayName`                                                                                                                                               | "å¸¦å»ºè®®çš„æ–‡æœ¬"                   | "Text with Suggestions"                           |
|                                         | `description`                                                                                                                                               | "æµ‹è¯•å¸¦å»ºè®®åˆ—è¡¨çš„æ–‡æœ¬è¾“å…¥"       | "Test for text input with suggestion list."       |
|                                         | `config.default`                                                                                                                                            | "é»˜è®¤å€¼"                         | "Default value"                                   |
|                                         | `config.placeholder`                                                                                                                                        | "è¾“å…¥æˆ–é€‰æ‹©å»ºè®®"                 | "Type or select suggestion"                       |
|                                         | `config.suggestions[0].displayName`                                                                                                                         | "é¢„è®¾ A"                         | "Preset A"                                        |
|                                         | `config.suggestions[1].displayName`                                                                                                                         | "é¢„è®¾ B"                         | "Preset B"                                        |
|                                         | `config.suggestions[2].displayName`                                                                                                                         | "å¦ä¸€ä¸ªé¢„è®¾"                     | "Another Preset"                                  |
| `int_with_suggestions`                  | `displayName`                                                                                                                                               | "å¸¦å»ºè®®çš„æ•´æ•°"                   | "Integer with Suggestions"                        |
|                                         | `description`                                                                                                                                               | "æµ‹è¯•å¸¦å»ºè®®åˆ—è¡¨çš„æ•´æ•°è¾“å…¥"       | "Test for integer input with suggestion list."    |
|                                         | `config.suggestions[0].displayName`                                                                                                                         | (åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰)               | "Two Hundred Fifty-Six (Low Resolution)"          |
|                                         | `config.suggestions[1].displayName`                                                                                                                         | (åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰)               | "Five Hundred Twelve (Medium Resolution)"         |
|                                         | `config.suggestions[2].displayName`                                                                                                                         | (åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰)               | "One Thousand Twenty-Four (High Resolution)"      |
|                                         | `config.suggestions[3].displayName`                                                                                                                         | (åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰)               | "Two Thousand Forty-Eight (Very High Resolution)" |
| `float_with_suggestions`                | `displayName`                                                                                                                                               | "å¸¦å»ºè®®çš„æµ®ç‚¹æ•°"                 | "Float with Suggestions"                          |
|                                         | `description`                                                                                                                                               | "æµ‹è¯•å¸¦å»ºè®®åˆ—è¡¨çš„æµ®ç‚¹æ•°è¾“å…¥"     | "Test for float input with suggestion list."      |
|                                         | `config.suggestions[0].displayName`                                                                                                                         | (åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰)               | "Minimum (1.0)"                                   |
|                                         | `config.suggestions[1].displayName`                                                                                                                         | (åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰)               | "Medium Low (5.0)"                                |
|                                         | `config.suggestions[2].displayName`                                                                                                                         | (åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰)               | "Medium (7.5)"                                    |
|                                         | `config.suggestions[3].displayName`                                                                                                                         | (åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰)               | "Medium High (10.0)"                              |
|                                         | `config.suggestions[4].displayName`                                                                                                                         | (åŸå§‹ä¸ºç©ºæˆ–æœªå®šä¹‰)               | "Maximum (12.5)"                                  |
| `button_trigger`                        | `displayName`                                                                                                                                               | "è§¦å‘æŒ‰é’®"                       | "Trigger Button"                                  |
|                                         | `description`                                                                                                                                               | "æµ‹è¯•æŒ‰é’®ç»„ä»¶"                   | "Test for button component."                      |
|                                         | `config.label`                                                                                                                                              | "ç‚¹æˆ‘æ‰§è¡Œæ“ä½œ"                   | "Click Me to Execute Operation!"                  |

### 5.3. Outputs å¯ç¿»è¯‘é¡¹

æ‰€æœ‰è¾“å‡ºé¡¹çš„ `displayName` å’Œ `description` å­—æ®µéƒ½æ˜¯å¯ç¿»è¯‘çš„ã€‚

| è¾“å‡ºé¡¹ Key (`TestWidgets.outputs.[key]`) | å¯ç¿»è¯‘å­—æ®µ    | åŸå§‹ä¸­æ–‡                    | è‹±æ–‡ç¿»è¯‘ç¤ºä¾‹                                |
| ---------------------------------------- | ------------- | --------------------------- | ------------------------------------------- |
| `string_output`                          | `displayName` | "å•è¡Œæ–‡æœ¬"                  | "Single Line Text Output"                   |
|                                          | `description` | "å•è¡Œæ–‡æœ¬è¾“å‡º"              | "Single line text output."                  |
| `text_output`                            | `displayName` | "å¤šè¡Œæ–‡æœ¬"                  | "Multi-line Text Output"                    |
|                                          | `description` | "å¤šè¡Œæ–‡æœ¬è¾“å‡º"              | "Multi-line text output."                   |
| `markdown_output`                        | `displayName` | "Markdown æ–‡æœ¬"             | "Markdown Text Output"                      |
|                                          | `description` | "Markdown å†…å®¹è¾“å‡º"         | "Markdown content output."                  |
| `int_output`                             | `displayName` | "æ•´æ•°"                      | "Integer Output"                            |
|                                          | `description` | "æ•´æ•°è¾“å‡º"                  | "Integer output."                           |
| `float_output`                           | `displayName` | "æµ®ç‚¹æ•°"                    | "Float Number Output"                       |
|                                          | `description` | "æµ®ç‚¹æ•°è¾“å‡º"                | "Float number output."                      |
| `boolean_output`                         | `displayName` | "å¸ƒå°”å€¼"                    | "Boolean Value Output"                      |
|                                          | `description` | "å¸ƒå°”å€¼è¾“å‡º"                | "Boolean value output."                     |
| `combo_output`                           | `displayName` | "é€‰æ‹©é¡¹"                    | "Selected Option Output"                    |
|                                          | `description` | "é€‰æ‹©é¡¹è¾“å‡º"                | "Selected option output."                   |
| `json_output`                            | `displayName` | "JSON å¯¹è±¡"                 | "JSON Object Output"                        |
|                                          | `description` | "JSON å¯¹è±¡è¾“å‡º"             | "JSON object output."                       |
| `javascript_code_output`                 | `displayName` | "JS ä»£ç ç‰‡æ®µ"               | "JS Code Snippet Output"                    |
|                                          | `description` | "JavaScript ä»£ç ç‰‡æ®µè¾“å‡ºã€‚" | "JavaScript code snippet output."           |
| `string_with_suggestions_output`         | `displayName` | "å¸¦å»ºè®®æ–‡æœ¬è¾“å‡º"            | "Text with Suggestions Output"              |
|                                          | `description` | "å¸¦å»ºè®®æ–‡æœ¬çš„è¾“å‡ºå€¼"        | "Output value of text with suggestions."    |
| `int_with_suggestions_output`            | `displayName` | "å¸¦å»ºè®®æ•´æ•°è¾“å‡º"            | "Integer with Suggestions Output"           |
|                                          | `description` | "å¸¦å»ºè®®æ•´æ•°çš„è¾“å‡ºå€¼"        | "Output value of integer with suggestions." |
| `float_with_suggestions_output`          | `displayName` | "å¸¦å»ºè®®æµ®ç‚¹æ•°è¾“å‡º"          | "Float with Suggestions Output"             |
|                                          | `description` | "å¸¦å»ºè®®æµ®ç‚¹æ•°çš„è¾“å‡ºå€¼"      | "Output value of float with suggestions."   |

### 5.4. å…³é”®è¯´æ˜

1.  **`config.suggestions` æ•°ç»„ç¿»è¯‘æœºåˆ¶**ï¼š

    - ç¿»è¯‘æ–‡ä»¶å¯ä»¥ä¸ºä»»ä½• `suggestions[i].displayName` æä¾›å€¼ï¼Œå³ä½¿åŸå§‹èŠ‚ç‚¹å®šä¹‰ä¸­è¯¥é¡¹çš„ `displayName` ä¸ºç©ºæˆ–æœªå®šä¹‰ã€‚
    - ç¿»è¯‘æŒ‰æ•°ç»„ç´¢å¼•åŒ¹é…ã€‚
    - `value` å±æ€§å§‹ç»ˆå–è‡ªåŸå§‹å®šä¹‰ï¼Œä¸ä¼šè¢«ç¿»è¯‘æ–‡ä»¶è¦†ç›–ã€‚

2.  **å‰ç«¯æ˜¾ç¤ºé€»è¾‘**ï¼š

    - å¦‚æœæœ€ç»ˆ `displayName`ï¼ˆç»ç¿»è¯‘åï¼‰ä¸ä¸ºç©ºï¼Œå‰ç«¯ä½¿ç”¨ `displayName` æ˜¾ç¤ºã€‚
    - å¦‚æœæœ€ç»ˆ `displayName` ä¸ºç©ºæˆ–æœªå®šä¹‰ï¼Œå‰ç«¯åº”æ˜¾ç¤ºæ ¼å¼åŒ–åçš„ `value`ã€‚

    ```json
    {
      "è¾“å…¥": "Input",
      "è¾“å‡º": "Output",
      "é…ç½®": "Configuration",
      "è®¾ç½®": "Settings",
      "ä¿å­˜": "Save",
      "å–æ¶ˆ": "Cancel",
      "ç¡®è®¤": "Confirm",
      "åˆ é™¤": "Delete",
      "ç¼–è¾‘": "Edit",
      "ui.button.save": "Save",
      "ui.button.cancel": "Cancel",
      "ui.dialog.confirm": "Confirm",
      "ui.dialog.warning": "Warning",
      "ui.dialog.error": "Error"
    }
    ```

    - åœ¨ `ComfyTavern/userData/{userId}/library/locales/` ç›®å½•ä¸‹é¢„ç•™ç›¸åŒçš„ç»“æ„ï¼Œä¾›ç”¨æˆ·è¦†ç›–ã€‚

3.  **è°ƒæ•´èŠ‚ç‚¹ API**:

    - ä¿®æ”¹ `/api/nodes` æ¥å£ï¼Œæ¥æ”¶è¯­è¨€å‚æ•°å¹¶è¿”å›å·²ç¿»è¯‘çš„èŠ‚ç‚¹å®šä¹‰ã€‚
    - æ”¯æŒä»è¯·æ±‚å‚æ•°å’Œ `Accept-Language` å¤´è·å–è¯­è¨€åå¥½ã€‚
    - é›†æˆ `LocalizationService` å¯¹èŠ‚ç‚¹å®šä¹‰è¿›è¡Œæ‰¹é‡ç¿»è¯‘ã€‚

4.  **å‰ç«¯é€‚é…**:
    - ç¡®ä¿åœ¨è¯·æ±‚èŠ‚ç‚¹æ•°æ®æ—¶ä¼ é€’è¯­è¨€å‚æ•°ã€‚
    - ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„å·²ç¿»è¯‘èŠ‚ç‚¹å®šä¹‰ã€‚
    - å‰ç«¯è´Ÿè´£å¤„ç†è‡ªèº« UI çš„å›½é™…åŒ–å®ç°ï¼Œä¸ä¾èµ–åç«¯ `LocalizationService`ã€‚

## 4. æœªæ¥å±•æœ›

- æ”¯æŒç”¨æˆ·åœ¨ç•Œé¢ä¸Šç®¡ç†å’Œåˆ‡æ¢è‡ªå®šä¹‰ç¿»è¯‘åŒ…ã€‚
- è€ƒè™‘å»ºç«‹ç¤¾åŒºç¿»è¯‘å…±äº«å¹³å°ã€‚
- æä¾›ç¿»è¯‘è´¡çŒ®å·¥å…·æˆ–æµç¨‹ã€‚
